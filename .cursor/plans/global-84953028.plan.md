<!-- 84953028-4e8f-4c16-95c1-1df6c85dd461 ee013c4e-00a8-4e59-a67b-daf2f9159ae7 -->
# Global Module Refactor

### Objectives

- Standardize controllers/services across `bookings`, `payments`, `fees`, `pricings`, `reports`, `staff_at_station`, and `users` so they mirror the patterns in `vehicle_station` and `stations` (guards, Swagger, response wrappers).
- Fill gaps where modules currently expose only DTOs by introducing complete Nest scaffolding (controller/service/module) wired to existing Mongoose schemas.
- Ensure DTOs declare every accepted field with validation + Swagger metadata and reuse enums from `src/common/enums`.
- Register newly created providers/models in `src/modules/<feature>/<feature>.module.ts`, `src/models/index.ts`, and `src/app.module.ts` as needed.

### Implementation Outline

1. Audit current module code to catalog missing components and shared utilities we can reuse (`ResponseDetail`, `ResponseList`, `apply*Mongo`).
2. For each target module, create/update controller methods that wrap service responses, add `@UseGuards(JwtAuthGuard, RolesGuard)` + `@Roles(...)`, and document endpoints with `@Api*` decorators.
3. Implement or refactor services to use injected Mongoose models, apply pagination helpers, and return project-standard response wrappers with custom exceptions.
4. Update or split DTOs into `create-` / `update-` variants when mutations exist, ensuring validation and Swagger alignment; wire them into controllers.
5. Adjust module files (`*.module.ts`) to import `MongooseModule.forFeature([...])`, export services if re-used, and add module imports to `AppModule`.
6. Add/adjust unit test placeholders or TODOs where new services are introduced (if existing test coverage is absent, note follow-up).

### Todos

- audit-modules: Catalogue existing endpoints, DTOs, and repositories per module to determine required scaffolding.
- refactor-controllers: Apply guard + Swagger patterns and response wrappers across all target controllers.
- refactor-services: Align services with repository injections, pagination helpers, and custom exceptions.
- update-dtos: Split and enhance DTOs (create/update/filter) with validation and Swagger metadata.
- wire-modules: Ensure Mongoose schemas and modules are registered in `src/models/index.ts` and `AppModule`.
- testing-plan: Identify testing adjustments or TODOs for newly introduced logic.

### To-dos

- [ ] Catalogue existing endpoints, DTOs, and repositories per module to determine required scaffolding.
- [ ] Apply guard + Swagger patterns and response wrappers across all target controllers.
- [ ] Align services with repository injections, pagination helpers, and custom exceptions.
- [ ] Split and enhance DTOs (create/update/filter) with validation and Swagger metadata.
- [ ] Ensure Mongoose schemas and modules are registered in src/models/index.ts and AppModule.
- [ ] Identify testing adjustments or TODOs for newly introduced logic.